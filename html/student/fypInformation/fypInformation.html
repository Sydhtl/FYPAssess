<!DOCTYPE html>
<html>
<head>
    <title>FYPAssess</title>
    <link rel="stylesheet" href="../../../css/student/dashboard.css">
    <link rel="stylesheet" href="../../../css/background.css">
    <link rel="stylesheet" href="../../../css/student/fypInformation.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>
<body>
    
    <div id="mySidebar" class="sidebar">
        <button class="menu-icon" onclick="openNav()">â˜°</button> 
        
        <div id="sidebarLinks">
            <a href="javascript:void(0)" class="closebtn" id="close" onclick="closeNav()">
                Close <span class="x-symbol">x</span>
            </a>
            <span id="nameSide">HI, NURUL SAIDAHTUL FATIHA BINTI SHAHARUDIN</span>
            <a href="../dashboard/dashboard.html" id="dashboard"> <i class="bi bi-house-fill" style="padding-right: 10px;"></i>Dashboard</a>
            <a href="./fypInformation.html" id="fypInformation" class="focus"><i class="bi bi-file-earmark-text-fill" style="padding-right: 10px;"></i>FYP Information</a>
            <a href="../logbook/logbook.html" id="logbookSubmission"><i class="bi bi-file-earmark-text-fill" style="padding-right: 10px;"></i>Logbook Submission</a>
            <a href="../notification/notification.html" id="notification"><i class="bi bi-bell-fill" style="padding-right: 10px;"></i>Notification</a>
            <a href="../signatureUpload/signatureUpload.html" id="signatureSubmission"><i class="bi bi-pen-fill" style="padding-right: 10px;"></i>Signature Submission</a>
          
            <a href="../../login/login.html" id="logout">
                <i class="bi bi-box-arrow-left" style="padding-right: 10px;"></i> Logout
            </a>
        </div>
    </div>
    
    <div id="containerAtas" class="containerAtas">
        
        <a href="../dashboard/dashboard.html">
            <img src="../../../assets/UPMLogo.png" alt="UPM logo" width="100px" id="upm-logo">
        </a>
        
        <div class="header-text-group">
            <div id="module-titles">
                <div id="containerModule">Student Module</div>
                <div id="containerFYPAssess">FYPAssess</div>
            </div>
            <div id="course-session">
                <div id="courseCode">SWE4949A</div>
                <div id="courseSession">2024/2025 - 2 </div>
            </div>
        </div>
    </div>

<div id="main">
    <div id="segmentTabs">
        <button id="tabInfo" class="segment active">FYP Information</button>
        <button id="tabPast" class="segment">Past Student's Title</button>
    </div>

    <div id="fypInfoSection" class="section">
        <h4 class="section-title">FYP Project Information</h4>

        <div class="info-card">
        <form id="fypInfoForm">
            <div class="row g-3">
                <div class="col-md-6">
                    <label class="form-label">Name</label>
                    <input type="text" class="form-control readonly-field" value="NURUL SAIDAHTUL FATIHA BINTI SHAHARUDIN" readonly>
                </div>
                <div class="col-md-6">
                    <label class="form-label">Matric No</label>
                    <input type="text" class="form-control readonly-field" value="214673" readonly>
                </div>
                <div class="col-md-6">
                    <label class="form-label">Programme</label>
                    <input type="text" class="form-control readonly-field" value="BACHELOR OF SOFTWARE ENGINEERING WITH HONOURS" readonly>
                </div>
                <div class="col-md-6">
                    <label class="form-label">Semester</label>
                    <input type="text" class="form-control readonly-field" value="2-2024/2025" readonly>
                </div>
                <div class="col-md-6">
                    <label class="form-label">Supervisor</label>
                    <input type="text" class="form-control readonly-field" value="DR. AZRINA BINTI KAMARUDDIN" readonly>
                </div>
                <div class="col-12">
                    <label class="form-label">FYP Title</label>
                    <textarea class="form-control readonly-field" id="fypTitle" rows="3" readonly>DEVELOPMENT OF AN AUTOMATED ASSESSMENT AND EVALUATION SYSTEM FOR BACHELOR PROJECTS (DEPARTMENT COORDINATORS AND STUDENT'S MODULE)</textarea>
                    <div class="mt-2 d-flex align-items-center">
                        <span id="titleStatus" class="status-note" style="display:none;">Status: Under consideration by supervisor</span>
                        <button type="button" id="changeTitleBtn" class="btn btn-outline-dark btn-sm ms-auto">Change Title</button>
                    </div>
                </div>
            </div>
            <div class="mt-3">
                <span class="small">Comment Section:</span>
                <a href="#" class="small">Download as PDF</a>
            </div>
        </form>
        </div>
    </div>

    <div id="pastTitlesSection" class="section" style="display:none;">
        <h4 class="section-title">Past Student's Title</h4>
        <div class="past-list">
            <div class="accordion" id="pastAccordion"></div>
        </div>
    </div>
    </div>
    

    <script>
    // --- JAVASCRIPT LOGIC ---
    function openNav() {
        var fullWidth = "220px"; 
        
        // 1. Expand the Sidebar
        document.getElementById("mySidebar").style.width = fullWidth;
        
        // 2. Push the main content AND the header container to the right
        document.getElementById("main").style.marginLeft = fullWidth;
        document.getElementById("containerAtas").style.marginLeft = fullWidth;
        
        // 3. Show the name and the links
        document.getElementById("nameSide").style.display = "block"; // <-- SHOW THE NAME
        
        var links = document.getElementById("sidebarLinks").getElementsByTagName("a");
        for (var i = 0; i < links.length; i++) {
            // Using flex for closebtn, block for others
            links[i].style.display = (links[i].id === 'close' ? 'flex' : 'block');
        }

        // 4. Hide the open icon
        document.getElementsByClassName("menu-icon")[0].style.display = "none";
    }

    function closeNav() {
        var collapsedWidth = "60px";

        // 1. Collapse the Sidebar
        document.getElementById("mySidebar").style.width = collapsedWidth;
        
        // 2. Move the main content AND the header container back
        document.getElementById("main").style.marginLeft = collapsedWidth;
        document.getElementById("containerAtas").style.marginLeft = collapsedWidth;

        // 3. Hide the name and the links
        document.getElementById("nameSide").style.display = "none"; // <-- HIDE THE NAME
        
        var links = document.getElementById("sidebarLinks").getElementsByTagName("a");
        for (var i = 0; i < links.length; i++) {
            links[i].style.display = "none";
        }
        
        // 4. Show the open icon
        document.getElementsByClassName("menu-icon")[0].style.display = "block";
    }


    	window.onload = function() {
        // We need to set the initial style for #nameSide here
        document.getElementById("nameSide").style.display = "none";
        closeNav();
    	// Tabs toggle
    	var tabInfo = document.getElementById('tabInfo');
    	var tabPast = document.getElementById('tabPast');
    	var infoSection = document.getElementById('fypInfoSection');
    	var pastSection = document.getElementById('pastTitlesSection');

    	tabInfo.addEventListener('click', function(){
    		tabInfo.classList.add('active');
    		tabPast.classList.remove('active');
    		infoSection.style.display = 'block';
    		pastSection.style.display = 'none';
    	});
    	tabPast.addEventListener('click', function(){
    		tabPast.classList.add('active');
    		tabInfo.classList.remove('active');
    		pastSection.style.display = 'block';
    		infoSection.style.display = 'none';
    	});
        
        // --- Title change flow ---
        var changeBtn = document.getElementById('changeTitleBtn');
        var fypTitleTextarea = document.getElementById('fypTitle');
        var statusNote = document.getElementById('titleStatus');

        // Build Edit Modal container
        var editModal = document.createElement('div');
        editModal.className = 'custom-modal';
        editModal.id = 'editTitleModal';
        document.body.appendChild(editModal);

        function openModal(modal){ modal.style.display = 'block'; }
        function closeModal(modal){ modal.style.display = 'none'; }

        // Renders the edit form view and wires up handlers
        function renderEditView() {
            editModal.innerHTML = `
                <div class="modal-dialog">
                    <div class="modal-content-custom">
                        <span class="close-btn" id="closeEditModal">&times;</span>
                        <div class="modal-title-custom">Change FYP Title</div>
                        <div class="modal-message">Update your title below. It will be sent for supervisor consideration.</div>
                        <textarea id="editTitleInput" class="form-control" rows="4"></textarea>
                        <div style="margin-top:15px; display:flex; gap:10px; justify-content:flex-end;">
                            <button id="cancelEdit" class="btn btn-light border" type="button">Cancel</button>
                            <button id="saveEdit" class="btn btn-success" type="button">Save</button>
                        </div>
                    </div>
                </div>`;

            // Prefill with current text
            var input = editModal.querySelector('#editTitleInput');
            input.value = fypTitleTextarea.value.trim();

            // Bind close/cancel
            editModal.querySelector('#closeEditModal').onclick = function(){ closeModal(editModal); };
            editModal.querySelector('#cancelEdit').onclick = function(){ closeModal(editModal); };

            // Bind save -> switch to confirmation view
            editModal.querySelector('#saveEdit').onclick = function(){
                statusNote.style.display = 'inline';
                fypTitleTextarea.value = input.value.trim();

                var contentHtml = `
                    <div class="modal-dialog">
                        <div class="modal-content-custom">
                            <span class="close-btn" id="closeEditModalAfter">&times;</span>
                            <div class="modal-icon"><i class="bi bi-send-check-fill"></i></div>
                            <div class="modal-title-custom">Title Submitted</div>
                            <div class="modal-message">Your fyp title is under consideration of your supervisor. The title will be changed once gotten the approval from the supervisor. Thank you!</div>
                            <div style="display:flex; justify-content:center;">
                                <button id="okSubmitted" class="btn btn-success" type="button">OK</button>
                            </div>
                        </div>
                    </div>`;

                editModal.innerHTML = contentHtml;
                editModal.querySelector('#okSubmitted').onclick = function(){
                    closeModal(editModal);
                    // Restore edit view for future changes
                    renderEditView();
                };
                editModal.querySelector('#closeEditModalAfter').onclick = function(){
                    closeModal(editModal);
                    renderEditView();
                };
            };
        }

        // Initial render of edit view
        renderEditView();

        changeBtn.addEventListener('click', function(){
            // Always ensure edit view is shown when opening
            renderEditView();
            openModal(editModal);
        });

        // --- Populate Past Titles grouped by Supervisor ---
        var pastData = [
            {
                supervisor: 'Dr. Azrina Binti Kamaruddin',
                students: [
                    { name: 'Aiman Zulkifli', title: 'IoT-based Smart Greenhouse Monitoring' },
                    { name: 'Nurul Izzah', title: 'Automated Grading System for Final Year Projects' },
                    { name: 'Muhammad Hafiz', title: 'Web-based Library Management System' }
                ]
            },
            {
                supervisor: 'Prof. Ahmad Rahman',
                students: [
                    { name: 'Siti Aminah', title: 'Mobile Attendance Tracking Using NFC' },
                    { name: 'Daniel Chong', title: 'Machine Learning for Plant Disease Detection' }
                ]
            },
            {
                supervisor: 'Dr. Siti Nurhaliza',
                students: [
                    { name: 'Sarah Abdullah', title: 'E-commerce Platform with Payment Integration' },
                    { name: 'Lee Wei Ming', title: 'Cloud-based Document Management System' }
                ]
            }
        ];

        var acc = document.getElementById('pastAccordion');
        if (acc) {
            acc.innerHTML = '';
            pastData.forEach(function(group, idx){
                var headerId = 'heading' + idx;
                var collapseId = 'collapse' + idx;
                var studentsHtml = group.students.map(function(s){
                    return '<div class="student-item"><strong>' + s.name + ':</strong> ' + s.title + '</div>';
                }).join('');
                var itemHtml = '<div class="supervisor-item">' +
                    '<button class="supervisor-btn" type="button" data-bs-toggle="collapse" data-bs-target="#' + collapseId + '" aria-expanded="false" aria-controls="' + collapseId + '">' +
                    '<span>' + group.supervisor + '</span>' +
                    '<i class="bi bi-chevron-down"></i>' +
                    '</button>' +
                    '<div id="' + collapseId + '" class="collapse supervisor-content" data-bs-parent="#pastAccordion">' +
                    '<div class="students-list">' + studentsHtml + '</div>' +
                    '</div>' +
                    '</div>';
                acc.insertAdjacentHTML('beforeend', itemHtml);
            });
        }
    };
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>